<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sélection de Vins</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>Sélectionnez vos vins</h1>

        <form method="get" action="/" id="wine-selection-form">
            <!-- Sélection du pays -->
            <div class="selection-step">
                <label for="country">Pays</label>
                <select name="country" id="country" onchange="this.form.submit()">
                    <option value="">Choisissez un pays</option>
                    {{range .Countries}}
                        <option value="{{.}}" 
                            {{if eq . $.SelectedCountry}}selected{{end}}>
                            {{.}} {{index $.CountryEmojis .}}
                        </option>
                    {{end}}
                </select>
            </div>

            <!-- Sélection de la région (conditionnelle) -->
            {{if .SelectedCountry}}
            <div class="selection-step">
                <label for="region">Région</label>
                <select name="region" id="region" onchange="this.form.submit()">
                    <option value="">Choisissez une région</option>
                    {{range .Regions}}
                        <option value="{{.}}" 
                            {{if eq . $.SelectedRegion}}selected{{end}}>
                            {{.}}
                        </option>
                    {{end}}
                </select>
            </div>
            {{end}}

            <!-- Sélection de la variété (conditionnelle) -->
            {{if and .SelectedCountry .SelectedRegion}}
            <div class="selection-step">
                <label for="variety">Variété</label>
                <select name="variety" id="variety" onchange="this.form.submit()">
                    <option value="">Choisissez une variété</option>
                    {{range .Varieties}}
                        <option value="{{.}}" 
                            {{if eq . $.SelectedVariety}}selected{{end}}>
                            {{.}}
                        </option>
                    {{end}}
                </select>
            </div>
            {{end}}
        </form>

        <!-- Affichage des vins sélectionnés -->
        {{if and .SelectedCountry .SelectedRegion .SelectedVariety}}
        <div class="wine-results">
            <h2>Vins correspondants</h2>
            {{if .SelectedWines}}
                <div class="wine-grid">
                    {{range .SelectedWines}}
                    <div class="wine-card">
                        <h3>{{.Title}}</h3>
                        <p>{{.Winery}} - {{.Variety}}</p>
                        <p>{{.Region}}, {{.Country}} {{index $.CountryEmojis .Country}}</p>
                        <p>Prix: {{printf "%.2f" .Price}}€</p>
                        <p>Notes: {{.Points}}/100</p>
                        <p>{{.Description}}</p>
                    </div>
                    {{end}}
                </div>
            {{else}}
                <p>Aucun vin trouvé pour cette sélection.</p>
            {{end}}
        </div>
        {{end}}
    </div>
</body>
</html>